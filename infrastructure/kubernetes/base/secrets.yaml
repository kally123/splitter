apiVersion: v1
kind: Secret
metadata:
  name: splitter-secrets
  namespace: splitter
type: Opaque
stringData:
  # Database credentials - REPLACE WITH ACTUAL VALUES
  DB_PASSWORD: "${DB_PASSWORD}"
  
  # JWT Secret - REPLACE WITH ACTUAL VALUE
  JWT_SECRET: "${JWT_SECRET}"
  
  # Redis password
  REDIS_PASSWORD: "${REDIS_PASSWORD}"
  
  # Kafka credentials
  KAFKA_USERNAME: "${KAFKA_USERNAME}"
  KAFKA_PASSWORD: "${KAFKA_PASSWORD}"
---
apiVersion: v1
kind: Secret
metadata:
  name: stripe-secrets
  namespace: splitter
type: Opaque
stringData:
  STRIPE_SECRET_KEY: "${STRIPE_SECRET_KEY}"
  STRIPE_WEBHOOK_SECRET: "${STRIPE_WEBHOOK_SECRET}"
---
apiVersion: v1
kind: Secret
metadata:
  name: aws-secrets
  namespace: splitter
type: Opaque
stringData:
  AWS_ACCESS_KEY_ID: "${AWS_ACCESS_KEY_ID}"
  AWS_SECRET_ACCESS_KEY: "${AWS_SECRET_ACCESS_KEY}"
---
apiVersion: v1
kind: Secret
metadata:
  name: email-secrets
  namespace: splitter
type: Opaque
stringData:
  SMTP_USERNAME: "${SMTP_USERNAME}"
  SMTP_PASSWORD: "${SMTP_PASSWORD}"
---
# External Secrets Operator - fetches secrets from AWS Secrets Manager
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: splitter-external-secrets
  namespace: splitter
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-secrets-manager
    kind: ClusterSecretStore
  target:
    name: splitter-secrets-from-aws
    creationPolicy: Owner
  data:
    - secretKey: DB_PASSWORD
      remoteRef:
        key: splitter/production/database
        property: password
    - secretKey: JWT_SECRET
      remoteRef:
        key: splitter/production/auth
        property: jwt_secret
    - secretKey: STRIPE_SECRET_KEY
      remoteRef:
        key: splitter/production/stripe
        property: secret_key
    - secretKey: STRIPE_WEBHOOK_SECRET
      remoteRef:
        key: splitter/production/stripe
        property: webhook_secret
